# AI 投資分析儀 - 完整使用手冊

**本地數據霸權，雲端 AI 賦能**

## 📖 目錄

1. [系統概述](#系統概述)
2. [快速開始](#快速開始)
3. [功能指南](#功能指南)
4. [進階操作](#進階操作)
5. [常見問題](#常見問題)

---

## 系統概述

AI 投資分析儀（Gemini Quant）是一套完整的量化投資分析系統，整合：

- **六大因子分析** - 價值、品質、動能、規模、波動、成長
- **AI 智慧分析** - Gemini 2.0 Flash 驅動
- **TDCC 籌碼追蹤** - 集保中心權威數據
- **15 個專業功能頁面** - 從基礎到進階
- **完整 API 服務** - RESTful架構

### 系統架構

```
┌─────────────────────────────────────────┐
│          前端應用 (React)                │
│     15個功能頁面 + 視覺化圖表            │
└───────────────┬─────────────────────────┘
                │ HTTP/REST API
┌───────────────▼─────────────────────────┐
│         API 服務層 (Flask)               │
│     15個RESTful端點 + 業務邏輯           │
└───────────────┬─────────────────────────┘
                │
┌───────────────▼─────────────────────────┐
│       計算引擎層 (Python)                │
│  因子計算 + 技術指標 + AI生成            │
└───────────────┬─────────────────────────┘
                │
┌───────────────▼─────────────────────────┐
│      資料層 (PostgreSQL)                 │
│  30+表格 + 250K+資料 + 預計算結果        │
└─────────────────────────────────────────┘
```

---

## 快速開始

### 首次啟動（3步驟）

#### 1. 環境檢查

確保已安裝：
- Docker Desktop（必須）
- Python 3.11+（必須）
- Node.js 18+（必須）

#### 2. 設定環境變數

```bash
# 複製環境變數範本
cp config/.env.example config/.env

# 編輯 .env 填入 API Keys
notepad config/.env
```

**必填項目**：
- `GEMINI_API_KEY` - 從 https://makersuite.google.com/app/apikey 獲取

**選填項目**（可暫時留空）：
- `FRED_API_KEY`
- `ALPHA_VANTAGE_API_KEY`
- `FINNHUB_API_KEY`

#### 3. 一鍵啟動

**Windows**：
```bash
start_all.bat
```

**跨平台**：
```bash
python startup_manager.py start
```

### 第一次使用

啟動後：
1. 訪問前端：http://localhost:5173
2. 訪問 API 文檔：http://localhost:5000/health
3. 登入 pgAdmin：http://localhost:15050
   - Email: admin@quant.local
   - Password: admin

---

## 功能指南

### 基礎功能（8個）

#### 1. 📊 Dashboard

**位置**：首頁  
**用途**：市場總覽、持股狀態、AI 觀點摘要

**主要功能**：
- 市場指數即時追蹤（台股、美股、VIX）
- 持股總覽與配置圓餅圖
- AI 每日觀點快速預覽
- 快速操作入口

**使用建議**：每日開盤前查看，了解整體市場狀況

#### 2. 📈 大戶同步率分析

**位置**：/shareholder-analysis  
**用途**：TDCC 籌碼分析、主力動向追蹤

**主要功能**：
- 15 個持股級距分布
- 大戶持股變化趨勢
- 同步率指標計算
- 資金流向判斷

**使用建議**：
- 每週六查看（TDCC 每週五更新）
- 關注大戶持股變化 > ±10%

**實例**：
```
台積電（2330）
- 1000張以上：15,234 人 (+125)
- 同步率：+8.5% ✅ (大戶增持)
- 建議：短期看多
```

#### 3. 🎯 因子投資儀表板

**位置**：/factor-dashboard  
**用途**：六大因子雷達圖、因子曝險分析

**主要功能**：
- 六大因子雷達圖視覺化
- 歷史因子趨勢追蹤
- 因子排序與篩選
- 因子說明與解讀

**六大因子**：
1. **價值因子** - P/E, P/B, 股息率
2. **品質因子** - ROE, ROA, 負債比
3. **動能因子** - RSI, 相對報酬, 52週高點距離
4. **規模因子** - 市值
5. **波動率因子** - 歷史波動、Beta
6. **成長因子** - 營收CAGR、EPS CAGR

**使用建議**：
- 總分 > 75：優質標的
- 總分 50-75：中等標的
- 總分 < 50：避開

#### 4. 🤖 AI 統一觀點

**位置**：/ai-insights  
**用途**：查看 AI 生成的每日報告與決策分析

**主要功能**：
- 每日戰略報告（自動更新）
- 市場分析與 AI 觀點
- Markdown 完整渲染
- 歷史報告追蹤

**使用時機**：
- 每日開盤前查看當日戰略
- 重大事件後查看 AI 分析
- 投資決策前參考 AI 建議

#### 5. 📉 技術分析中心

**位置**：/technical-analysis  
**用途**：K線圖、技術指標、成交量分析

**主要功能**：
- 價格走勢圖（支援多時間週期）
- MA 均線系統（5/10/20/60日）
- RSI 超買超賣指標
- 成交量柱狀圖

**實用技巧**：
- MA5 突破 MA20 = 黃金交叉（買進信號）
- RSI > 70 = 超買（考慮賣出）
- RSI < 30 = 超賣（考慮買進）

#### 6. 💼 投資組合管理

**位置**：/portfolio  
**用途**：持股明細、風險分析、績效追蹤

**主要功能**：
- 持股明細表格
- 資產配置圓餅圖
- 風險指標（Beta, Sharpe Ratio）
- 報酬率計算

**關鍵指標**：
- **Sharpe Ratio > 1**：風險調整後報酬佳
- **Max Drawdown < 20%**：風險控制良好
- **Beta < 1**：波動低於大盤

#### 7. 📰 新聞管理中心

**位置**：/news  
**用途**：RSS 訂閱、新聞過濾、AI 摘要

**主要功能**：
- RSS 新聞訂閱
- 關鍵字過濾
- AI 自動摘要
- 情緒分析標籤

**使用建議**：
- 訂閱重要財經媒體 RSS
- 設定關鍵字（公司名、產業）
- 每日瀏覽 AI 摘要節省時間

#### 8. ⚙️ 系統設定

**位置**：/settings  
**用途**：個人化設定、通知管理、參數調整

**主要功能**：
- Dark Mode 切換
- 通知設定
- 技術指標參數調整
- 語言切換

---

### 進階功能（7個）

#### 9. 🎯 投資組合優化

**位置**：/optimization  
**用途**：效率前緣分析、蒙地卡羅模擬

**主要功能**：
- 10,000 次蒙地卡羅模擬
- 效率前緣曲線繪製
- 最佳權重配置建議
- 風險報酬權衡分析

**使用場景**：
- 新增標的時重新優化配置
- 定期（每季）檢視投資組合效率
- 風險調整：降低高風險部位

**解讀結果**：
```
推薦配置（Sharpe Ratio = 1.25）
- 2330 台積電：35%
- 0050 台灣50：30%
- 2454 聯發科：20%
- 現金：15%
```

#### 10. 🔬 策略回測實驗室

**位置**：/backtesting  
**用途**：No-Code 策略建構、歷史回測

**主要功能**：
- 視覺化策略建構器
- 歷史績效回測
- 完整交易明細
- 績效指標（Sharpe, Win Rate）

**策略範例**：
```
規則 1: 當 MA(5) > MA(20) → 買入 100%
規則 2: 當 MA(5) < MA(20) → 賣出 100%
規則 3: 當 RSI < 30 → 買入 50%

回測期間：2020-2024
結果：
- 總報酬：+45%
- 年化報酬：+12.8%
- 勝率：58.5%
- 最大回撤：-15.3%
```

#### 11. ⚠️ 投資組合壓力測試

**位置**：/stress-testing  
**用途**：歷史情境模擬、風險量化

**主要功能**：
- 4 大歷史情境（2008海嘯、2020疫情等）
- VaR (95%) 計算
- CVaR 尾部風險
- 對沖建議生成

**情境測試**：
```
2008 金融海嘯情境
- 當前市值：$5,850,000
- 情境後市值：$3,575,000
- 預估虧損：-38.9%
- 恢復時間：14個月

建議：增加防禦型資產至 20%
```

#### 12. 🎯 投資目標追蹤

**位置**：/goals  
**用途**：財務目標設定、進度監控

**主要功能**：
- 多目標設定（退休/購屋/教育）
- 資產成長預測（20年）
- 達成率分析
- 所需報酬率計算

**目標範例**：
```
退休基金
- 目標金額：$20,000,000
- 當前金額：$5,850,000
- 目標日期：2045-12-31
- 每月定期定額：$30,000
- 所需報酬率：6.5%/年
- 進度：✅ 正常
```

#### 13. 💬 對話式 AI 分析師

**位置**：/ai-chat  
**用途**：自然語言查詢、即時分析

**主要功能**：
- 自然語言問答
- 即時股票分析
- 投資建議生成
- 上下文理解

**使用範例**：
```
你：分析台積電（2330）
AI：根據最新因子分析，台積電表現優異...
    - 品質因子：88.5分
    - 總分：79.7分
    - 建議：長期持有

你：我的投資組合如何？
AI：您的投資組合風險評估...
    - 夏普比率：0.82（中等）
    - 建議降低台積電持股至15%
```

#### 14. 🔍 相似資產發現器

**位置**：/similar-assets  
**用途**：因子 DNA 比對、替代標的推薦

**主要功能**：
- 因子雷達圖比對
- 相似度計算（0-100%）
- 因子差異分析
- Top N 推薦

**應用場景**：
- 尋找投資組合擴充標的
- 找出估值偏低的相似股票
- 分散產業風險

**結果範例**：
```
種子股票：2330 台積電

發現相似資產：
1. 2454 聯發科（92.5% 相似度）
   - 因子DNA相近
   - 估值較便宜(-8%)
   
2. 2317 鴻海（87.3% 相似度）
   - 規模因子相似
   - 股息率更高(+1.2%)
```

#### 15. 🔔 智慧事件警報系統

**位置**：/alerts  
**用途**：多維度監控、即時提醒

**主要功能**：
- 6 類警報監控
- 觸發條件設定
- 推播通知（Email/LINE）
- AI 噪音過濾

**支援的警報類型**：
1. **價格警報** - 突破/跌破價格、均線
2. **成交量警報** - 爆量、縮量
3. **因子警報** - 因子分數變化
4. **財報警報** - EPS 超預期
5. **技術指標警報** - RSI 超買/超賣、MACD 交叉
6. **新聞警報** - 關鍵字匹配

**設定範例**：
```
警報：台積電價格跌破 MA20
條件：當 收盤價 < MA(20)
動作：發送 LINE 通知
狀態：✅ 監控中
```

---

## 進階操作

### API 直接調用

如果您是程式開發者，可以直接調用 API：

```python
import requests

# 獲取因子分數
response = requests.get('http://localhost:5000/api/factors/2330?market=tw')
data = response.json()
print(data['scores'])

# 生成 AI 報告
response = requests.post('http://localhost:5000/api/ai/daily-report')
report = response.json()
print(report['report'])
```

完整 API 文檔請參考：`API_SERVER_GUIDE.md`

### 自動化工作流

啟動 N8N 自動化：

```bash
python startup_manager.py start --n8n
```

訪問 N8N：http://localhost:5678

預設工作流：
- 每日 02:00 - 更新股價資料
- 每日 06:00 - 生成 AI 報告
- 每5分鐘 - 檢查價格警報

### 資料庫直接查詢

使用 pgAdmin 進行進階查詢：

```sql
-- 查詢高分股票
SELECT stock_code, stock_name, total_score
FROM quant_scores
JOIN tw_stock_info USING (stock_code)
WHERE calculation_date = CURRENT_DATE
  AND total_score > 80
ORDER BY total_score DESC
LIMIT 10;
```

---

## 常見問題

### Q: 首次啟動需要多久？
A: 約 3-5 分鐘。資料庫初始化需要約 30 秒，前端編譯需要 2-3 分鐘。

### Q: 資料多久更新一次？
A: 
- 股價：每日收盤後自動更新
- TDCC 籌碼：每週六
- AI 報告：每日早上 6:00
- 因子分數：每日收盤後

### Q: 可以追蹤美股嗎？
A: 可以。系統同時支援台股和美股，在搜尋時選擇市場即可。

### Q: AI 報告是即時生成的嗎？
A: 系統會快取 AI 報告。統合報告有效期 7 天，個股報告 3 天。過期後會自動重新生成。

### Q: 如何新增自己的策略？
A: 使用「策略回測實驗室」的視覺化建構器，無需寫程式即可建立策略。

### Q: 系統需要多少硬碟空間？
A: 約 80-100 GB（含完整歷史資料）。可依需求調整回溯深度。

### Q: 可以在手機上使用嗎？
A: 前端支援響應式設計，可在平板上良好顯示。手機瀏覽體驗較差，建議使用電腦或平板。

### Q: 如何備份資料？
A: 
1. 手動備份：`docker exec quant_postgres pg_dump -U postgres quant_db > backup.sql`
2. 自動備份：使用 N8N 工作流，每日自動備份

### Q: 遇到錯誤怎麼辦？
A: 
1. 查看 `DEPLOYMENT_GUIDE.md` 的故障排除章節
2. 檢查 Docker 容器日誌：`docker-compose logs`
3. 重啟服務：`stop_all.bat` 然後 `start_all.bat`

---

## 🎯 最佳實踐

### 每日工作流程

**開盤前（08:30）**
1. 查看 Dashboard 了解市場狀況
2. 閱讀 AI 每日觀點
3. 檢查智慧警報通知

**盤中（09:00-13:30）**
1. 監控持股技術分析
2. 查看重要新聞（AI 摘要）
3. 關注警報觸發

**收盤後（14:00-18:00）**
1. 查看當日績效
2. 更新投資組合
3. 規劃隔日策略

**每週例行（週末）**
1. 檢視 TDCC 大戶同步率
2. 重新平衡投資組合
3. 檢視投資目標進度

### 投資決策流程

```
1. 初步篩選
   └─ 因子投資儀表板（總分 > 75）
   
2. 深度分析
   ├─ AI 統一觀點（查看 AI 建議）
   ├─ 技術分析中心（確認進場時機）
   └─ 大戶同步率（籌碼面確認）
   
3. 組合評估
   ├─ 投資組合優化（權重建議）
   ├─ 壓力測試（風險評估）
   └─ 策略回測（歷史驗證）
   
4. 執行交易
   └─ 設定智慧警報（價格提醒）
   
5. 持續追蹤
   └─ 投資目標追蹤（進度監控）
```

---

**版本**: 1.0.0  
**最後更新**: 2024-11-23  
**系統狀態**: 生產就緒 ✅
